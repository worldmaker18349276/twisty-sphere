<!DOCTYPE html>
<html lang="en">
<head>
  <title>twisty sphere</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <script src="js/three.min.js"></script>
  <script src="js/QuickHull.js"></script>
  <script src="js/ConvexGeometry.js"></script>

  <script src="js/Geometry.js"></script>
  <script src="js/twistySphere.js"></script>
</head>
<body>
<script>
var t0 = 0;
function tic(info) {
  t0 = new Date().getTime()/1000;
  if ( info )
    console.log(info);
}
function toc(info) {
  var dt = (t0 - new Date().getTime()/1000);
  if ( info )
    console.log(info, dt);
  else
    console.log(dt);
}

function rot(axis, angle) {
  return new THREE.Quaternion().setFromAxisAngle(axis.clone().normalize(), angle);
}

var display = new Display();
// var builder = new TwistySphereBuilder({
//   shape: new THREE.BoxGeometry(20,20,20),
//   inner_part: true
// });
var builder = new TwistyBallBuilder({});
var controller = new TwistController({builder, display, R:1.1});
var puzzle = builder.make();
display.add(puzzle);

// builder.split(puzzle,
//   builder.plane( 1, 1, 1,1),
//   builder.plane(-1,-1, 1,1),
//   builder.plane(-1, 1,-1,1),
//   builder.plane( 1,-1,-1,1)
// );

builder.split(puzzle,
  builder.plane( 0, 1, 1,1/2),
  builder.plane( 0, 1,-1,1/2),
  builder.plane( 0,-1, 1,1/2),
  builder.plane( 0,-1,-1,1/2),
  builder.plane( 1, 0, 1,1/2),
  builder.plane( 1, 0,-1,1/2),
  builder.plane(-1, 0, 1,1/2),
  builder.plane(-1, 0,-1,1/2),
  builder.plane( 1, 1, 0,1/2),
  builder.plane( 1,-1, 0,1/2),
  builder.plane(-1, 1, 0,1/2),
  builder.plane(-1,-1, 0,1/2)
);

function element() {
  return controller.selectElement(puzzle)
    .then(([e, i]) => console.log(e)).then(element)
    .catch(console.log);
}

function plane() {
  return controller.selectCutPlane(puzzle)
    .then(([p, i]) => console.log(p)).then(plane)
    .catch(console.log);
}

function twist() {
  return controller.selectCutPlane(puzzle, (_, x) => puzzle.userData.angles[x])
    .catch(e => {if ( e == "esc" ) { throw "cancel twist"; } throw e; })
    .then(([_, x]) => controller.selectTwist(puzzle, x))
    .catch(e => {if ( e == "esc" ) { twist(); throw "re-select twist"; } throw e; })
    .then(([_, __, x, i]) => builder.animatedTwist(puzzle, x, i, display))
    .then(() => { builder.analyze(puzzle); return twist(); })
    .catch(console.log);
}

</script>

  <div style="position:fixed;bottom:10px;left:10px;">
    <button onclick="element()"> select element </button>
    <button onclick="builder.analyze(puzzle); plane()"> select cut plane </button>
    <button onclick="builder.analyze(puzzle); twist();"> twist </button>
  </div>
</body>
</html>
